### [C和C++混合编程超详细讲解](https://blog.csdn.net/weixin_42031299/article/details/126688788?ops_request_misc=&request_id=&biz_id=102&utm_term=c++%E5%85%A5%E9%97%A8%20c%E5%92%8Cc++%E6%B7%B7%E5%90%88%E7%BC%96%E8%AF%91&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-126688788.142^v86^koosearch_v1,239^v2^insert_chatgpt&spm=1018.2226.3001.4187)

#### 1、为什么需要C和C++混合编程

- C++是在C语言的基础上发展出来的，在C++发明之前已经用C语言实现了很多功能库，C++要使用这些库就涉及到调用C语言；
- C++和C语言各自有更适合的领域，在大型项目中都需要使用，涉及到C和C++的互相调用。比如嵌入式设备开发中，应用层开发、算法开发中使用C++，底层的操作系统、音视频开发使用C语言；

#### 2、为什么不同的语言可以混合编程

- 程序编译的过程：高级语言->汇编语言->二进制代码->链接->可执行程序->烧录镜像；
- 任何语言最终都要变成二进制的可执行程序才能在CPU上运行，不同的高级语言在编译成汇编语言的过程是不一样的，所以每种高级语言都有自己的编译器；
- 不管哪种高级语言在汇编语言阶段或者二进制代码阶段时都是一样的格式，互相之间是可以调用的，也就是我们常看到的库文件，开发中常把代码编译成库供其他人调用；
- 高级语言的目标都是编译成汇编指令，汇编指令是和CPU相关而与高级语言无关，所以CPU相同的情况下，每种高级语言在汇编阶段都是统一的；

#### 3、C和C++混合编程的困难

##### 3.1、C++的函数重载带来的麻烦

- C和C++之间互相调用是根据函数名进行，在链接时通过函数名将函数对应的二进制代码链接起来；
- C++支持函数重载：C++中可以有相同名字的函数，只要同名函数的传参不同，C++就不会报错，并根据调用时的传参来选择调用对应的函数；
- 在符号表中，C语言的函数名是不考虑传参的，但是C++的函数名是和传参类型有关的，这就导致通一个函数在C和C++中函数名不一致，也就会导致在链接时找不到函数的报错；

##### 3.2、验证C++的函数重载机制

###### 3.2.1、C++代码

```cpp
//cppTest.cpp

int add(int a, int b)
{
  return a+b;
}

float add(float a, float b)
{
  return a+b;
}
```

###### 3.2.2、C代码

```c
//cTest.c

int add(int a, int b)
{
	return a+b;
}
```

###### 3.2.3、编译成汇编代码

```bash
//得到c代码对应的汇编代码
gcc -c cTest.c -o cTest.o
objdump -d cTest.o > cTest.i

//得到c++代码对应的汇编代码
g++ -c cppTest.c -o cppTest.o
objdump -d cppTest.o > cppTest.i
```

###### 3.2.4、实验结果分析

![image-20230508232123459](./c和c++混合编程详解.assets/image-20230508232123459.png)

- C++支持函数重载，所以可以在C++代码中定义两个同名但传参不同的函数，函数名分别叫`_Z3addii`和`_Z3addff`，其中最后两个字母和传参有关，`ii`表示两个传参都是`int`型，`ff`表示两个传参都是`float`型；
- 通过对比，在`C`和`C++`中`int add(int a, int b)`函数的汇编代码都是一样的，不同的是函数名称，在`C`语言中是`add`，在`C++`中是`_Z3addii`；
- 经过实现可知，如果不经过任何处理，虽然`C`和`C++`都定义了同样的`add`函数，但是经过编译后得到的汇编代码中函数名称却不同，这会导致链接时找不到函数；
